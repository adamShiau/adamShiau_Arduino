# 硬體架構整合文件

> **功能**: GMINS 系統完整硬體架構設計和整合說明  
> **適用系統**: GMINS v2.0  
> **版本**: v2.0  
> **最後更新**: 2025-08-08  

## 🏗️ 硬體架構總覽

GMINS v2.0 採用成熟的硬體架構設計，基於 MINSPixhawk 的實戰經驗，提供穩定可靠的硬體平台。系統以 Arduino MCU 為核心，整合多個高精度感測器和飛控系統，形成完整的導航解決方案。

### 系統拓撲架構
```
                            GMINS v2.0 硬體架構
                     ╔════════════════════════════════╗
                     ║         Arduino MCU            ║
                     ║      (System Controller)       ║
                     ║                                ║
                     ║  ┌──────────────────────────┐  ║
                     ║  │    SERCOM Configuration  │  ║
                     ║  │  • SERCOM1 → Serial3     │  ║
                     ║  │  • SERCOM2 → Serial2     │  ║
                     ║  │  • SERCOM3 → Serial4     │  ║
                     ║  │  • SERCOM5 → Serial1     │  ║
                     ║  └──────────────────────────┘  ║
                     ╚═══════┬═══════┬═══════┬════════╝
                             │       │       │
    ┌────────────────────────┴───────┼───────┼─────────────────────────┐
    │                                │       │                         │
    ▼                                ▼       ▼                         ▼
┌─────────┐                    ┌─────────┐ ┌─────────┐           ┌─────────┐
│Pixhawk  │◄──MAVLink 460800──►│ Serial1 │ │ Serial2 │◄──XBUS──►│MTi-680  │
│PX4 FC   │                    │SERCOM5  │ │SERCOM2  │  115200  │IMU/AHRS │
│         │                    └─────────┘ └─────────┘           │Sensor   │
│• EKF2   │                                                      │         │
│• Mission│                                                      │• 四元數 │
│• Control│                                                      │• 角速度 │
└─────────┘                                                      │• 加速度 │
                                                                 │• GPS    │
                                                                 └─────────┘
                                                                      ▲
                                                                      │NMEA
                                                                      │115200
                                                                 ┌─────────┐
                                                                 │ Serial3 │
                                                                 │SERCOM1  │
                                                                 └─────────┘
                                                                      ▲
                                                                      │NMEA
                                                                      │轉發
                                                                 ┌─────────┐
                                                                 │ Serial4 │◄──NMEA──►┌─────────┐
                                                                 │SERCOM3  │  115200  │LOCOSYS  │
                                                                 └─────────┘           │GPS      │
                                                                                      │Receiver │
                                                                                      │         │
                                                                                      │• 高精度 │
                                                                                      │• 雙天線 │
                                                                                      │• RTK    │
                                                                                      └─────────┘
```

## 🔧 核心硬體組件

### 1. Arduino MCU (中央處理器)
**型號**: Arduino 兼容 MCU with SERCOM 支援  
**功能**: 系統核心控制器  

#### 核心規格
- **處理器**: ARM Cortex-M0+ 或更高
- **時脈**: 48MHz 或更高
- **記憶體**: 至少 32KB Flash, 4KB SRAM
- **IO 接口**: 支援 4 路硬體 UART (SERCOM)
- **電源**: 3.3V 或 5V 系統兼容

#### SERCOM 配置能力
```
SERCOM 功能表:
┌────────────┬────────────┬──────────┬──────────────┐
│  SERCOM    │  Arduino   │   鮑率   │    用途      │
│   編號     │  Serial    │          │              │
├────────────┼────────────┼──────────┼──────────────┤
│ SERCOM1    │  Serial3   │ 115200   │ NMEA 輸出    │
│ SERCOM2    │  Serial2   │ 115200   │ XBUS 感測器  │
│ SERCOM3    │  Serial4   │ 115200   │ NMEA 輸入    │
│ SERCOM5    │  Serial1   │ 460800   │ MAVLink 高速 │
└────────────┴────────────┴──────────┴──────────────┘
```

### 2. Xsens MTi-680 感測器
**型號**: Xsens MTi-680 GNSS/INS  
**功能**: 高精度慣性導航感測器  

#### 技術規格
- **IMU 精度**: 高精度 MEMS 慣性感測器
- **GNSS**: 多星座 GNSS 接收器
- **輸出頻率**: 最高 400Hz (IMU), 4Hz (GNSS)
- **通訊協定**: XBUS (二進制協定)
- **座標系統**: 可配置 ENU/NED
- **校準**: 工廠校準，支援磁校準

#### 資料輸出內容
```
MTi-680 資料封包內容:
• 四元數 (q0, q1, q2, q3)
• 歐拉角 (Roll, Pitch, Yaw)
• 角速度 (ωx, ωy, ωz)
• 加速度 (ax, ay, az)
• 磁力計 (mx, my, mz)
• GPS 位置 (緯度, 經度, 高度)
• GPS 速度 (Vx, Vy, Vz)
• 時間戳記 (UTC 時間)
• 感測器狀態和品質資訊
```

### 3. Pixhawk PX4 飛控
**型號**: Pixhawk 系列飛行控制器  
**功能**: 無人機飛行控制和任務管理  

#### 系統特性
- **處理器**: STM32F7 或更高等級
- **飛控軟體**: PX4 Autopilot
- **估算器**: EKF2 狀態估算器
- **通訊**: MAVLink v2.0 協定
- **感測器**: 內建 IMU, 氣壓計, 磁力計
- **擴展性**: 支援外部感測器輸入

#### MAVLink 整合
```
Pixhawk 接收的 MAVLink 訊息:
┌─────────────────┬──────────┬────────────────────┐
│   訊息類型      │   ID     │      功能          │
├─────────────────┼──────────┼────────────────────┤
│ ODOMETRY        │   #331   │ 位置姿態融合資料   │
│ GPS_RAW_INT     │   #24    │ GPS 原始資料       │
│ GPS_INPUT       │   #232   │ GPS 輸入資料       │
│ TIMESYNC        │   #111   │ 時間同步           │
└─────────────────┴──────────┴────────────────────┘
```

### 4. LOCOSYS GPS 接收器
**型號**: LOCOSYS GPS 模組  
**功能**: 高精度 GNSS 定位  

#### 技術特性
- **多星座**: GPS, GLONASS, BeiDou, Galileo
- **更新率**: 1-10Hz 可配置
- **精度**: 單點定位 2-5m, RTK < 10cm
- **天線**: 支援雙天線配置
- **輸出**: NMEA 0183 標準協定
- **特殊功能**: 航向測量 ($PLSHD)

#### NMEA 訊息支援
```
LOCOSYS 輸出 NMEA 句子:
• $GPGGA - 全球定位系統固定資料
• $GPRMC - 推薦最小定位資料  
• $GPVTG - 地速和航向資料
• $GPGSA - GNSS DOP 和活躍衛星
• $GPGSV - GNSS 衛星可視資訊
• $GPGST - GNSS 偽距雜訊統計
• $GPZDA - 日期和時間資料
• $GPHDT - GNSS 真航向
• $PLSHD - 專用航向資料 (雙天線)
```

## ⚡ 電源和信號設計

### 電源規劃
```
系統電源架構:
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   主電源    │    │   穩壓電源   │    │   負載分配   │
│             │    │             │    │             │
│ • 12V 輸入  ├────► • 5V 3A      ├────► • Arduino   │
│ • 鋰電池   │    │ • 3.3V 1A    │    │ • MTi-680   │
│ • BEC 輸出  │    │ • 電源濾波   │    │ • GPS 模組  │
└─────────────┘    └─────────────┘    └─────────────┘
```

### 信號完整性
- **串列埠信號**: 3.3V LVTTL 標準
- **接地**: 所有設備共用接地參考
- **隔離**: 可選光電隔離保護
- **濾波**: 電源和信號線 EMI 濾波
- **屏蔽**: 重要信號線使用屏蔽電纜

## 🔌 連接器和接線

### 標準連接器配置
```
連接器分配表:
┌─────────────┬──────────────┬─────────────────┬──────────────┐
│   設備      │   連接器     │     接線        │   注意事項   │
├─────────────┼──────────────┼─────────────────┼──────────────┤
│ Pixhawk     │ DF13-6P      │ TX,RX,GND,5V    │ 高速傳輸     │
│ MTi-680     │ JST-4P       │ TX,RX,GND,5V    │ 穩定電源     │
│ GPS 模組    │ JST-4P       │ TX,RX,GND,3.3V  │ 低雜訊      │
│ 調試接口    │ Micro-USB    │ USB Serial      │ 開發調試     │
└─────────────┴──────────────┴─────────────────┴──────────────┘
```

### 引腳定義 (Arduino)
```cpp
// GMINS v2.0 引腳定義
// Serial1 (SERCOM5) - Pixhawk MAVLink
#define PIXHAWK_TX_PIN    6   // PA22
#define PIXHAWK_RX_PIN    7   // PA23

// Serial2 (SERCOM2) - MTi-680 XBUS  
#define MTI680_TX_PIN     4   // PA08
#define MTI680_RX_PIN     3   // PA09

// Serial3 (SERCOM1) - NMEA Output
#define NMEA_OUT_TX_PIN   1   // PA10
#define NMEA_OUT_RX_PIN   0   // PA11

// Serial4 (SERCOM3) - NMEA Input
#define GPS_RX_PIN        2   // PA06
#define GPS_TX_PIN        5   // PA07

// 狀態指示燈
#define STATUS_LED_PIN   13   // 系統狀態
#define ERROR_LED_PIN    12   // 錯誤指示
#define COMM_LED_PIN     11   // 通訊活動
```

## 📊 性能和規格

### 系統性能指標
| 性能項目 | 規格 | 備註 |
|---------|-----|------|
| 系統延遲 | < 5ms | 端到端處理延遲 |
| 資料頻率 | 100Hz | IMU 資料處理頻率 |
| GPS 頻率 | 10Hz | GPS 資料處理頻率 |
| 串列埠總頻寬 | ~650Kbps | 所有通道總和 |
| 功耗 | < 2W | 穩態運行功耗 |
| 工作溫度 | -20°C to +70°C | 工業級溫度範圍 |

### 可靠性指標
- **MTBF**: > 10,000 小時
- **連續運行**: 24/7 無人值守
- **故障恢復**: < 1 秒自動恢復
- **資料完整性**: > 99.9%
- **通訊成功率**: > 99.95%

## 🔍 測試和驗證

### 硬體測試項目
1. **電源測試**: 電壓穩定性，紋波測量
2. **通訊測試**: 串列埠通訊品質，錯誤率
3. **時序測試**: 資料同步精度，延遲測量
4. **環境測試**: 溫度，振動，EMI 測試
5. **長期穩定性**: 72小時連續運行測試

### 整合測試
```
整合測試流程:
1. 單元測試 → 各設備獨立功能測試
2. 介面測試 → 設備間通訊測試  
3. 系統測試 → 完整系統功能測試
4. 性能測試 → 系統性能指標驗證
5. 可靠性測試 → 長期穩定性驗證
```

## 🔗 相關文件連結

### 硬體設計文件
- [[2.硬體架構/UART配置說明]] - 詳細串列埠配置
- [[4.源代碼架構/通訊模組設計]] - Communication Manager 設計

### 軟體設計文件  
- [[3.軟體架構重新設計/新軟體架構設計]] - 整體軟體架構
- [[4.源代碼架構/核心模組設計]] - 核心模組設計

### 測試和維護
- [[5.實作指導/測試策略]] - 完整測試策略
- [[5.實作指導/開發環境設置]] - 開發環境配置

---

**最後更新**: 2025-08-08  
**適用版本**: GMINS v2.0  
**維護者**: GMINS 開發團隊  
**硬體相容性**: 基於 MINSPixhawk v1.0 實戰驗證架構