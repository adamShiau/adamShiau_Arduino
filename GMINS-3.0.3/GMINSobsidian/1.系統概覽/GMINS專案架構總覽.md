# GMINS 專案架構總覽

> **功能**: Global Multi-sensor Integrated Navigation System 整體架構說明  
> **版本**: v2.0  
> **最後更新**: 2025-08-08  
> **專案狀態**: 全新重構設計

## 🎯 專案目標

GMINS (Global Multi-sensor Integrated Navigation System) 是基於 MINSPixhawk 專案經驗，完全重新設計的**新世代多感測器整合導航系統**。本專案保持相同的硬體架構，但採用全新的軟體設計理念，提供更高的可維護性、模組化程度和系統穩定性。

### 核心改進目標
- **完全重構軟體**：基於現有經驗，重新撰寫所有核心代碼
- **模組化設計**：清晰分離的功能模組，提升可維護性
- **架構標準化**：建立明確的開發規範和代碼組織標準
- **性能最佳化**：改善系統響應時間和資源使用效率
- **文檔完備性**：提供完整的技術文檔和開發指導

## 🏗️ 系統架構概覽

### 整體架構圖
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   LOCOSYS GPS   │    │  Xsens MTi-680  │    │   Pixhawk PX4   │
│   (NMEA 輸入)    │    │   (XBUS 協定)   │    │  (MAVLink 協定) │
└─────────┬───────┘    └─────────┬───────┘    └─────────┬───────┘
          │                      │                      │
          │ Serial4              │ Serial2              │ Serial1
          │ 115200               │ 115200               │ 460800
          │                      │                      │
    ┌─────▼──────────────────────▼──────────────────────▼─────┐
    │                GMINS Core System                        │
    │              (全新架構設計)                             │
    │                                                        │
    │  ┌─────────────────┐  ┌─────────────────┐              │
    │  │   Communication │  │    Fusion       │              │
    │  │     Manager     │  │    Engine       │              │
    │  └─────────────────┘  └─────────────────┘              │
    │                                                        │
    │  ┌─────────────────┐  ┌─────────────────┐              │
    │  │     System      │  │     Safety      │              │
    │  │    Controller   │  │    Guardian     │              │
    │  └─────────────────┘  └─────────────────┘              │
    │                                                        │
    │  ┌─────────────────┐  ┌─────────────────┐              │
    │  │      Data       │  │      Utils      │              │
    │  │   Processor     │  │    Library      │              │
    │  └─────────────────┘  └─────────────────┘              │
    └─────────────────────┬───────────────────────────────────┘
                          │ Serial3
                          │ 115200 (NMEA 輸出)
                          │
              ┌─────────────────┐
              │ MTi-680 GNSS    │
              │   輔助輸入      │
              └─────────────────┘
```

## 🔧 核心系統模組

### 1. Communication Manager (通訊管理器)
**職責**: 統一管理所有硬體通訊介面
- **UART 管理**: 4路串列埠統一管理和監控
- **協定處理**: MAVLink、XBUS、NMEA 協定解析和封裝
- **資料緩衝**: 智能緩衝區管理和流量控制
- **錯誤恢復**: 通訊異常檢測和自動恢復

### 2. Fusion Engine (融合引擎)
**職責**: 多感測器數據融合和狀態估計
- **GNSS-AHRS 融合**: 進階融合算法實作
- **動態權重系統**: 基於運動狀態的智能權重調整
- **座標轉換**: 統一的座標系統轉換處理
- **時間同步**: 精確的多感測器時間對齊

### 3. System Controller (系統控制器)
**職責**: 整體系統生命週期管理
- **初始化流程**: 系統啟動和設備檢查
- **運行狀態管理**: 系統模式切換和狀態監控
- **配置管理**: 動態參數配置和調整
- **診斷介面**: 系統健康檢查和問題診斷

### 4. Safety Guardian (安全守護)
**職責**: 系統安全和可靠性保障
- **數據驗證**: 多層數據有效性檢查
- **故障檢測**: 硬體和軟體故障自動檢測
- **容錯處理**: 故障時的降級和恢復策略
- **安全限制**: 防止惡意操作和系統過載

### 5. Data Processor (數據處理器)
**職責**: 高效的數據處理和格式轉換
- **即時處理**: 低延遲數據處理管道
- **格式轉換**: 各種數據格式間的轉換
- **品質評估**: 數據品質分析和評分
- **歷史管理**: 重要數據的歷史記錄

### 6. Utils Library (工具函式庫)
**職責**: 共用工具函數和基礎設施
- **數學運算**: 四元數、矩陣、座標轉換等
- **日誌系統**: 統一的日誌記錄和管理
- **記憶體管理**: 高效的記憶體使用管理
- **調試工具**: 開發和調試輔助工具

## 🚀 關鍵技術特性

### 新架構優勢
1. **模組化設計**: 每個模組職責明確，便於維護和擴展
2. **標準化介面**: 統一的模組間通訊介面設計
3. **錯誤隔離**: 單一模組故障不影響整體系統運行
4. **可配置性**: 支援動態配置調整和個性化設定
5. **可測試性**: 每個模組都可以獨立測試和驗證

### 性能提升
- **處理延遲**: < 5ms 端到端處理延遲 (相比舊版 <10ms)
- **記憶體效率**: 優化記憶體使用，減少 30% 記憶體占用
- **CPU 負載**: 優化演算法，降低至 50-70% CPU 使用率
- **系統穩定性**: 24/7 連續運行，故障自動恢復

### 開發標準
- **代碼品質**: 嚴格的編碼規範和代碼審查
- **文檔完備**: 每個模組都有詳細的技術文檔
- **測試覆蓋**: 單元測試和整合測試覆蓋率 > 90%
- **版本控制**: 規範的 Git 工作流程和版本管理

## 📊 技術規格

### 系統性能指標
| 指標項目 | GMINS v2.0 | MINSPixhawk v1.0 | 改善程度 |
|---------|-----------|------------------|----------|
| 處理延遲 | < 5ms | < 10ms | 50% 改善 |
| 記憶體使用 | < 3KB | < 4KB | 25% 改善 |
| CPU 負載 | 50-70% | 60-80% | 15% 改善 |
| 代碼行數 | ~3000 | ~4500 | 33% 減少 |
| 模組數量 | 6個核心模組 | 混合架構 | 結構化 |

### 硬體兼容性
- **完全兼容**: 保持與 MINSPixhawk 相同的硬體配置
- **UART 配置**: 4路串列埠配置維持不變
- **感測器支援**: 支援相同的感測器和設備
- **連接方式**: 無需修改現有硬體連接

## 🔄 開發流程

### 階段一：核心架構建立
1. **模組介面設計**: 定義各模組間的標準介面
2. **基礎設施開發**: Utils Library 和基礎組件
3. **通訊層實作**: Communication Manager 開發
4. **測試框架建立**: 單元測試和整合測試環境

### 階段二：核心功能實作
1. **融合引擎開發**: Fusion Engine 核心演算法
2. **系統控制器**: System Controller 生命週期管理
3. **安全機制**: Safety Guardian 安全保障功能
4. **數據處理**: Data Processor 高效處理管道

### 階段三：整合測試與優化
1. **系統整合**: 各模組整合和聯調
2. **性能調優**: 系統性能優化和調整
3. **穩定性測試**: 長期運行和壓力測試
4. **文檔完善**: 技術文檔和使用指南

## 🔗 相關文件連結

### 核心設計文件
- [[2.硬體架構/硬體架構整合文件]] - 硬體配置和連接說明
- [[3.軟體架構重新設計/新軟體架構設計]] - 詳細軟體架構設計
- [[src目錄結構設計]] - 源代碼組織和結構

### 開發指導
- [[5.實作指導/開發環境設置]] - 開發環境配置和工具
- [[5.實作指導/編碼規範]] - 代碼風格和開發標準
- [[5.實作指導/測試策略]] - 測試方法和品質保證

### 技術參考
- [[4.源代碼架構/核心模組設計]] - 各核心模組詳細設計
- [[4.源代碼架構/通訊模組設計]] - Communication Manager 實作
- [[4.源代碼架構/融合演算法模組設計]] - Fusion Engine 演算法設計

---

**最後更新**: 2025-08-08  
**專案負責人**: GMINS 開發團隊  
**版本**: v2.0 - 全新架構設計  
**狀態**: 架構設計完成，準備開始開發