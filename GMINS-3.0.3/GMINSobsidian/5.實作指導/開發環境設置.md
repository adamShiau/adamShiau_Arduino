# é–‹ç™¼ç’°å¢ƒè¨­ç½®

> **åŠŸèƒ½**: GMINS v2.0 é–‹ç™¼ç’°å¢ƒé…ç½®å’Œå·¥å…·éˆè¨­ç½®æŒ‡å—  
> **ç‰ˆæœ¬**: v2.0  
> **æœ€å¾Œæ›´æ–°**: 2025-08-08  
> **æ”¯æ´å¹³å°**: Windows, macOS, Linux

## ğŸ¯ é–‹ç™¼ç’°å¢ƒæ¦‚è¦½

### æ ¸å¿ƒé–‹ç™¼å·¥å…·
1. **PlatformIO**: ä¸»è¦é–‹ç™¼å¹³å°å’Œå»ºæ§‹ç³»çµ±
2. **Visual Studio Code**: æ¨è–¦çš„æ•´åˆé–‹ç™¼ç’°å¢ƒ
3. **Git**: ç‰ˆæœ¬æ§åˆ¶ç³»çµ±
4. **Unity**: å–®å…ƒæ¸¬è©¦æ¡†æ¶
5. **Arduino CLI**: Arduino ç›¸é—œå·¥å…·éˆ

### ç³»çµ±éœ€æ±‚
- **ä½œæ¥­ç³»çµ±**: Windows 10+, macOS 10.14+, Ubuntu 18.04+
- **è¨˜æ†¶é«”**: æœ€å°‘ 4GB RAM (æ¨è–¦ 8GB+)
- **å„²å­˜ç©ºé–“**: è‡³å°‘ 2GB å¯ç”¨ç©ºé–“
- **ç¶²è·¯**: ç©©å®šçš„ç¶²è·¯é€£æ¥ (ä¸‹è¼‰ç›¸ä¾å¥—ä»¶)

## ğŸ”§ é–‹ç™¼å·¥å…·å®‰è£

### 1. Visual Studio Code å®‰è£
```bash
# Windows (ä½¿ç”¨ Chocolatey)
choco install vscode

# macOS (ä½¿ç”¨ Homebrew)
brew install --cask visual-studio-code

# Ubuntu
sudo snap install --classic code
```

### 2. PlatformIO å®‰è£
```bash
# æ–¹æ³•ä¸€ï¼šé€šé VS Code æ“´å±•å®‰è£
# 1. æ‰“é–‹ VS Code
# 2. é€²å…¥æ“´å±•é¢æ¿ (Ctrl+Shift+X)
# 3. æœç´¢ "PlatformIO IDE"
# 4. å®‰è£ PlatformIO IDE æ“´å±•

# æ–¹æ³•äºŒï¼šé€šé pip å®‰è£
pip install platformio

# é©—è­‰å®‰è£
pio --version
```

### 3. Git å®‰è£å’Œé…ç½®
```bash
# Windows
winget install Git.Git

# macOS
brew install git

# Ubuntu
sudo apt-get install git

# Git å…¨å±€é…ç½®
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"
git config --global init.defaultBranch main
```

## ğŸ“ å°ˆæ¡ˆçµæ§‹è¨­ç½®

### å‰µå»ºæ–°çš„ GMINS å°ˆæ¡ˆ
```bash
# å‰µå»ºå°ˆæ¡ˆç›®éŒ„
mkdir GMINS_v2.0
cd GMINS_v2.0

# åˆå§‹åŒ– PlatformIO å°ˆæ¡ˆ
pio project init --board zeroUSB --ide vscode

# å‰µå»ºå®Œæ•´ç›®éŒ„çµæ§‹
mkdir -p src/{core,communication,data,utils,hardware,external}
mkdir -p tests/{unit_tests,integration_tests,system_tests}
mkdir -p docs/{api,examples,diagrams}
mkdir -p tools/{config_tools,test_tools}
mkdir -p .vscode
```

### PlatformIO å°ˆæ¡ˆé…ç½®
```ini
; platformio.ini
[platformio]
default_envs = arduino_zero
src_dir = src
test_dir = tests
data_dir = data
lib_dir = lib

; é–‹ç™¼ç’°å¢ƒé…ç½®
[env:arduino_zero]
platform = atmelsam
board = zeroUSB  
framework = arduino
monitor_speed = 115200
lib_ldf_mode = deep+

; ç·¨è­¯å™¨è¨­ç½®
build_flags = 
    -DGMINS_VERSION=2.0
    -std=c++14
    -Wall
    -Wextra
    -O2

; é™¤éŒ¯è¨­ç½®
build_type = debug
debug_tool = atmel-ice
debug_init_break = tbreak setup

; å‡½å¼åº«ç›¸ä¾æ€§
lib_deps = 
    SPI
    Wire
    ArduinoJson@^6.19.0
    Unity

; æ¸¬è©¦ç’°å¢ƒ
[env:native_test]
platform = native
framework = 
build_flags = 
    -DUNIT_TEST
    -std=c++14
test_framework = unity
test_filter = unit_tests/*
test_build_src = true

; æ•´åˆæ¸¬è©¦ç’°å¢ƒ
[env:integration_test]  
platform = atmelsam
board = zeroUSB
framework = arduino
test_framework = unity
test_filter = integration_tests/*
upload_protocol = atmel-ice

; æ€§èƒ½æ¸¬è©¦ç’°å¢ƒ
[env:performance_test]
platform = atmelsam
board = zeroUSB
framework = arduino
build_flags = 
    -DPERFORMANCE_TEST
    -O3
test_filter = performance_tests/*
```

## âš™ï¸ VS Code é…ç½®

### å·¥ä½œå€è¨­ç½®
```json
// .vscode/settings.json
{
    "C_Cpp.intelliSenseEngine": "Tag Parser",
    "C_Cpp.default.cppStandard": "c++14",
    "C_Cpp.default.cStandard": "c11",
    "C_Cpp.default.compilerPath": "${workspaceFolder}/.pio/build/arduino_zero/src",
    
    "files.associations": {
        "*.h": "cpp",
        "*.cpp": "cpp",
        "*.ino": "cpp"
    },
    
    "files.exclude": {
        "**/.pio": true,
        "**/build": true,
        "**/*.o": true,
        "**/*.bin": true,
        "**/*.hex": true
    },
    
    "editor.tabSize": 4,
    "editor.insertSpaces": true,
    "editor.rulers": [100],
    
    "terminal.integrated.shell.windows": "powershell.exe",
    
    "platformio-ide.useBuiltinPIOCore": true,
    "platformio-ide.activateOnlyOnPlatformIOProject": false
}
```

### æ¨è–¦æ“´å±•
```json
// .vscode/extensions.json
{
    "recommendations": [
        "platformio.platformio-ide",
        "ms-vscode.cpptools",
        "ms-vscode.cmake-tools",
        "twxs.cmake",
        "ms-python.python",
        "streetsidesoftware.code-spell-checker",
        "gruntfuggly.todo-tree",
        "aaron-bond.better-comments",
        "ms-vscode.hexeditor",
        "ms-vscode-remote.remote-ssh"
    ]
}
```

### å»ºæ§‹å’Œé™¤éŒ¯é…ç½®
```json
// .vscode/tasks.json
{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "PlatformIO: Build",
            "type": "shell",
            "command": "pio run",
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "presentation": {
                "panel": "new"
            },
            "problemMatcher": ["$gcc"]
        },
        {
            "label": "PlatformIO: Upload",
            "type": "shell",
            "command": "pio run -t upload",
            "group": "build",
            "presentation": {
                "panel": "new"
            }
        },
        {
            "label": "PlatformIO: Clean",
            "type": "shell",
            "command": "pio run -t clean",
            "group": "build"
        },
        {
            "label": "PlatformIO: Test",
            "type": "shell",
            "command": "pio test",
            "group": "test",
            "presentation": {
                "panel": "new"
            }
        },
        {
            "label": "Run Unit Tests",
            "type": "shell",
            "command": "pio test -e native_test",
            "group": "test"
        },
        {
            "label": "Generate Documentation",
            "type": "shell",
            "command": "doxygen Doxyfile",
            "group": "build"
        }
    ]
}
```

### é™¤éŒ¯é…ç½®
```json
// .vscode/launch.json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "PlatformIO Debugger",
            "type": "platformio-debug",
            "request": "launch",
            "preLaunchTask": "PlatformIO: Build",
            "internalConsoleOptions": "openOnSessionStart"
        },
        {
            "name": "Unity Test Debugger",
            "type": "cppdbg",
            "request": "launch",
            "program": "${workspaceFolder}/.pio/build/native_test/program",
            "args": [],
            "stopAtEntry": false,
            "cwd": "${workspaceFolder}",
            "environment": [],
            "externalConsole": false,
            "MIMode": "gdb",
            "setupCommands": [
                {
                    "description": "Enable pretty-printing for gdb",
                    "text": "-enable-pretty-printing",
                    "ignoreFailures": true
                }
            ],
            "preLaunchTask": "PlatformIO: Build"
        }
    ]
}
```

## ğŸ”¨ å»ºæ§‹ç³»çµ±é…ç½®

### CMake æ•´åˆ (é¸ç”¨)
```cmake
# CMakeLists.txt
cmake_minimum_required(VERSION 3.16)
project(GMINS_v2.0)

set(CMAKE_CXX_STANDARD 14)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# åŒ…å«ç›®éŒ„
include_directories(src)
include_directories(lib)

# ç·¨è­¯é¸é …
add_compile_definitions(
    GMINS_VERSION=2.0
    ARDUINO=100
)

# æºæ–‡ä»¶æ”¶é›†
file(GLOB_RECURSE CORE_SOURCES "src/core/*.cpp")
file(GLOB_RECURSE COMM_SOURCES "src/communication/*.cpp")
file(GLOB_RECURSE DATA_SOURCES "src/data/*.cpp")
file(GLOB_RECURSE UTILS_SOURCES "src/utils/*.cpp")
file(GLOB_RECURSE HW_SOURCES "src/hardware/*.cpp")

# å‰µå»ºæ ¸å¿ƒå‡½å¼åº«
add_library(gmins_core 
    ${CORE_SOURCES}
    ${COMM_SOURCES}
    ${DATA_SOURCES}
    ${UTILS_SOURCES}
    ${HW_SOURCES}
)

# æ¸¬è©¦é…ç½®
enable_testing()

file(GLOB_RECURSE TEST_SOURCES "tests/unit_tests/*.cpp")
add_executable(unit_tests ${TEST_SOURCES})
target_link_libraries(unit_tests gmins_core)

add_test(NAME unit_tests COMMAND unit_tests)

# æ–‡ä»¶ç”Ÿæˆ
find_package(Doxygen)
if(DOXYGEN_FOUND)
    configure_file(${CMAKE_CURRENT_SOURCE_DIR}/Doxyfile.in 
                   ${CMAKE_CURRENT_BINARY_DIR}/Doxyfile @ONLY)
    add_custom_target(docs
        ${DOXYGEN_EXECUTABLE} ${CMAKE_CURRENT_BINARY_DIR}/Doxyfile
        WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
        COMMENT "Generating API documentation with Doxygen" VERBATIM
    )
endif()
```

### è‡ªå‹•åŒ–å»ºæ§‹è…³æœ¬
```bash
#!/bin/bash
# scripts/build.sh

set -e  # é‡åˆ°éŒ¯èª¤æ™‚ç«‹å³é€€å‡º

# é¡è‰²å®šç¾©
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${GREEN}Starting GMINS v2.0 build process...${NC}"

# æ¸…ç†ä¹‹å‰çš„å»ºæ§‹
echo -e "${YELLOW}Cleaning previous build...${NC}"
pio run -t clean

# æª¢æŸ¥ä»£ç¢¼é¢¨æ ¼
echo -e "${YELLOW}Checking code style...${NC}"
if command -v clang-format &> /dev/null; then
    find src -name "*.cpp" -o -name "*.h" | xargs clang-format -i
    echo -e "${GREEN}Code formatting completed.${NC}"
else
    echo -e "${YELLOW}clang-format not found, skipping code formatting.${NC}"
fi

# å»ºæ§‹å°ˆæ¡ˆ
echo -e "${YELLOW}Building project...${NC}"
pio run -e arduino_zero

# é‹è¡Œå–®å…ƒæ¸¬è©¦
echo -e "${YELLOW}Running unit tests...${NC}"
pio test -e native_test

# é‹è¡Œæ•´åˆæ¸¬è©¦ (å¦‚æœç¡¬é«”å¯ç”¨)
if [ "$1" == "--with-hardware" ]; then
    echo -e "${YELLOW}Running integration tests...${NC}"
    pio test -e integration_test
fi

# ç”Ÿæˆæ–‡ä»¶
echo -e "${YELLOW}Generating documentation...${NC}"
if command -v doxygen &> /dev/null; then
    doxygen Doxyfile
    echo -e "${GREEN}Documentation generated in docs/html/${NC}"
else
    echo -e "${YELLOW}Doxygen not found, skipping documentation generation.${NC}"
fi

echo -e "${GREEN}Build process completed successfully!${NC}"
```

## ğŸ“Š ä»£ç¢¼å“è³ªå·¥å…·

### ä»£ç¢¼æ ¼å¼åŒ–è¨­ç½®
```yaml
# .clang-format
BasedOnStyle: Google
IndentWidth: 4
UseTab: Never
ColumnLimit: 100
AllowShortFunctionsOnASingleLine: InlineOnly
AllowShortIfStatementsOnASingleLine: false
AllowShortLoopsOnASingleLine: false
BreakBeforeBraces: Attach
IndentCaseLabels: false
SpaceAfterCStyleCast: true
SpaceBeforeParens: ControlStatements
```

### éœæ…‹åˆ†æé…ç½®
```yaml
# .cppcheck
--enable=all
--std=c++14
--platform=avr8
--suppress=missingIncludeSystem
--suppress=unusedFunction
--suppress=unmatchedSuppression
--inline-suppr
--xml
--xml-version=2
```

### Pre-commit é‰¤å­
```bash
#!/bin/sh
# .git/hooks/pre-commit

# æª¢æŸ¥ä»£ç¢¼æ ¼å¼
echo "Checking code format..."
if command -v clang-format &> /dev/null; then
    CHANGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(cpp|h)$')
    if [ -n "$CHANGED_FILES" ]; then
        for file in $CHANGED_FILES; do
            clang-format -i "$file"
            git add "$file"
        done
    fi
fi

# é‹è¡Œå¿«é€Ÿæ¸¬è©¦
echo "Running unit tests..."
pio test -e native_test --silent

if [ $? -ne 0 ]; then
    echo "Tests failed. Commit aborted."
    exit 1
fi

echo "Pre-commit checks passed."
exit 0
```

## ğŸš€ é–‹ç™¼å·¥ä½œæµç¨‹

### æ—¥å¸¸é–‹ç™¼æµç¨‹
```bash
# 1. æ›´æ–°ä»£ç¢¼åº«
git pull origin main

# 2. å‰µå»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/new-fusion-algorithm

# 3. é–‹ç™¼å’Œæ¸¬è©¦
pio run                    # å»ºæ§‹
pio test -e native_test    # å–®å…ƒæ¸¬è©¦
pio run -t upload          # ä¸Šå‚³åˆ°ç¡¬é«”

# 4. æäº¤æ›´æ”¹
git add .
git commit -m "Add new fusion algorithm implementation"

# 5. æ¨é€åˆ†æ”¯
git push origin feature/new-fusion-algorithm

# 6. å‰µå»º Pull Request (åœ¨ GitHub/GitLab)
```

### ç‰ˆæœ¬ç™¼å¸ƒæµç¨‹
```bash
# scripts/release.sh
#!/bin/bash

VERSION=$1
if [ -z "$VERSION" ]; then
    echo "Usage: $0 <version>"
    exit 1
fi

echo "Preparing release $VERSION..."

# æ›´æ–°ç‰ˆæœ¬è™Ÿ
sed -i "s/GMINS_VERSION=.*/GMINS_VERSION=$VERSION/" platformio.ini

# é‹è¡Œå®Œæ•´æ¸¬è©¦å¥—ä»¶
./scripts/build.sh --with-hardware

# å‰µå»ºç‰ˆæœ¬æ¨™ç±¤
git add .
git commit -m "Bump version to $VERSION"
git tag -a "v$VERSION" -m "Release version $VERSION"

# æ¨é€åˆ°é ç¨‹
git push origin main
git push origin "v$VERSION"

echo "Release $VERSION created successfully!"
```

## ğŸ”— ç›¸é—œæ–‡ä»¶é€£çµ

### é–‹ç™¼æŒ‡å°
- [[5.å¯¦ä½œæŒ‡å°/ç·¨ç¢¼è¦ç¯„]] - ä»£ç¢¼é¢¨æ ¼å’Œé–‹ç™¼æ¨™æº–
- [[5.å¯¦ä½œæŒ‡å°/æ¸¬è©¦ç­–ç•¥]] - æ¸¬è©¦æ–¹æ³•å’Œå“è³ªä¿è­‰

### æ¶æ§‹æ–‡ä»¶
- [[srcç›®éŒ„çµæ§‹è¨­è¨ˆ]] - æºä»£ç¢¼çµ„ç¹”çµæ§‹
- [[3.è»Ÿé«”æ¶æ§‹é‡æ–°è¨­è¨ˆ/æ–°è»Ÿé«”æ¶æ§‹è¨­è¨ˆ]] - æ•´é«”è»Ÿé«”æ¶æ§‹

### å°ˆæ¡ˆæ–‡ä»¶
- [[1.ç³»çµ±æ¦‚è¦½/GMINSå°ˆæ¡ˆæ¶æ§‹ç¸½è¦½]] - å°ˆæ¡ˆæ•´é«”æ¶æ§‹
- [[2.ç¡¬é«”æ¶æ§‹/ç¡¬é«”æ¶æ§‹æ•´åˆæ–‡ä»¶]] - ç¡¬é«”é…ç½®èªªæ˜

---

**æœ€å¾Œæ›´æ–°**: 2025-08-08  
**é©ç”¨ç‰ˆæœ¬**: GMINS v2.0  
**ç¶­è­·è€…**: GMINS é–‹ç™¼åœ˜éšŠ  
**æ”¯æ´å¹³å°**: PlatformIO + VS Code + Arduino ç”Ÿæ…‹ç³»çµ±